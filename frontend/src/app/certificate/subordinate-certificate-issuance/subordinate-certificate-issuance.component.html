<div class="mainContainer">
  <div class="window">
    <div class="inside-div">
      <h2 class="title">Add Subordinate Certificate</h2>

      <div class="container" [formGroup]="certificateForm">

        <!-- subject info -->
        <div class="row gap">
          <div class="col">
            <label for="commonName">
              Common Name (CN)*:
              <input type="text" id="commonName" formControlName="commonName" required>
            </label>
          </div>

          <div class="col">
            <label for="country">
              Country (C)*:
              <input type="text" id="country" formControlName="country" maxlength="2" required>
            </label>
          </div>

          <div class="col">
            <label for="organizationalUnit">
              Organizational Unit (OU):
              <input type="text" id="organizationalUnit" formControlName="organizationalUnit">
            </label>
          </div>
        </div>

        <div class="row gap">
          <div class="col">
            <label for="state">
              State (ST):
              <input type="text" id="state" formControlName="state">
            </label>
          </div>

          <div class="col">
            <label for="locality">
              Locality (L):
              <input type="text" id="locality" formControlName="locality">
            </label>
          </div>
        </div>

        <hr>

        <!-- user selection -->
        
        <table mat-table [dataSource]="userDataSource" class="mat-elevation-z8">

          <ng-container matColumnDef="firstName">
            <th mat-header-cell *matHeaderCellDef> FistName </th>
            <td mat-cell *matCellDef="let user"> {{user.firstName}} </td>
          </ng-container>

          <ng-container matColumnDef="lastName">
            <th mat-header-cell *matHeaderCellDef> LastName </th>
            <td mat-cell *matCellDef="let user">
              {{user.lastName}}
            </td>
          </ng-container>

          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef> Email </th>
            <td mat-cell *matCellDef="let user"> {{user.email}} </td>
          </ng-container>

          <ng-container matColumnDef="organization">
            <th mat-header-cell *matHeaderCellDef> Organization </th>
            <td mat-cell *matCellDef="let user"> {{user.organization}} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedUserColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedUserColumns;" 
            (click)="onUserSelected(row)"></tr>
        </table>

        <mat-paginator [length]="totalElements"
                      [pageSize]="pageSize"
                      (page)="onUserPageChanged($event)">
        </mat-paginator>

        <hr>

        <!-- date selection -->
        <div class="row gap date-row">
          <div class="date-col">
            <label>Pick start date:
              <input type="date" formControlName="validFrom">
            </label>
          </div>
          <div class="date-col">
            <label>Pick expiration date:
              <input type="date" formControlName="validTo">
            </label>
          </div>
        </div>

        <hr>

        <!-- certificates selection -->
        <table mat-table [dataSource]="certificateDataSource" class="mat-elevation-z8">

          <ng-container matColumnDef="serialNumber">
            <th mat-header-cell *matHeaderCellDef> Serial Number </th>
            <td mat-cell *matCellDef="let cert"> {{cert.serialNumber}} </td>
          </ng-container>

          <ng-container matColumnDef="certificateType">
            <th mat-header-cell *matHeaderCellDef> Certificate Type </th>
            <td mat-cell *matCellDef="let cert">
              {{cert.certificateType}}
            </td>
          </ng-container>

          <ng-container matColumnDef="issuerMail">
            <th mat-header-cell *matHeaderCellDef> Issuer Email </th>
            <td mat-cell *matCellDef="let cert"> {{cert.issuerEmail}} </td>
          </ng-container>

          <ng-container matColumnDef="subjectMail">
            <th mat-header-cell *matHeaderCellDef> Subject Email </th>
            <td mat-cell *matCellDef="let cert"> {{cert.subjectEmail}} </td>
          </ng-container>

          <ng-container matColumnDef="details">
            <th mat-header-cell *matHeaderCellDef> Details </th>
            <td mat-cell *matCellDef="let cert">
              <button mat-stroked-button color="primary" (click)="viewDetails(cert)">Details</button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedCertificateColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedCertificateColumns;" (click)="onCertificateSelected(row)"></tr>
        </table>

        <mat-paginator [length]="totalElements"
                      [pageSize]="pageSize"
                      (page)="onCertificatePageChange($event)">
        </mat-paginator>

        <hr>

        <!-- key usages -->
        <div class="usage-row">
          <div class="usage-col">
            <h5>Key Usages</h5>
            <div *ngFor="let option of keyUsageOptions" class="form-check">
              <input
                type="checkbox"
                class="form-check-input"
                [value]="option"
                (change)="onCheckboxChange($event, keyUsagesFormArray)">
              <label class="form-check-label">{{ option }}</label>
            </div>
          </div>

          <div class="usage-col">
            <h5>Extended Key Usages</h5>
            <div *ngFor="let option of extendedKeyUsageOptions" class="form-check">
              <input
                type="checkbox"
                class="form-check-input"
                [value]="option"
                (change)="onCheckboxChange($event, extendedKeyUsagesFormArray)">
              <label class="form-check-label">{{ option }}</label>
            </div>
          </div>
        </div>

        <hr>

        <!-- certificate type -->
        <div class="row gap">
          <div class="col">
            <h5>Select Certificate Type</h5>
            <div class="form-check">
              <input class="form-check-input" type="radio" formControlName="certificateType" id="intermediate" value="INTERMEDIATE">
              <label class="form-check-label" for="intermediate">Intermediate Certificate</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" formControlName="certificateType" id="endEntity" value="END_ENTITY">
              <label class="form-check-label" for="endEntity">End Entity Certificate</label>
            </div>
          </div>
        </div>

        <div class="add-button">
          <button type="button" class="btn custombutton btn-primary" [disabled]="certificateForm.invalid" (click)="createCertificate()">
            Confirm
          </button>
        </div>

      </div>
    </div>
  </div>
</div>
